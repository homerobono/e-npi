<div class="form-row" [formGroup]='activitiesFormGroup' *ngIf='npi.stage>2'>
  <div class='col'>
    <label for='activities' class=col>
      <center>
        <h4>Etapas Macro do Projeto</h4>
      </center>
    </label>
    <div id='activities' formArrayName='activities'>
      <table class="table table-sm table-bordered table-hover" #table>
        <thead class='thead-light'>
          <tr>
            <th scope="col" rowspan=2>#</th>
            <th scope="col" rowspan=2>Atividade</th>
            <th scope="col" rowspan=2>Responsável</th>
            <th scope="col" colspan=3>Prazo</th>
            <th scope="col" rowspan=2>Arquivos</th>
            <th scope="col" rowspan=1>Status</th>
            <th scope="col" rowspan=2>Aplicável</th>
          </tr>
          <tr>
            <th scope=col>Período (dias)</th>
            <th class='date' scope=col>Início</th>
            <th class='date' scope=Fim>Término</th>
            <th>
              <button class='btn btn-sm btn-light text-primary shadow-none pr-0' type=button (click)='closeAllActivities()'>
              <i class='fa fa-check pr-0 mr-0'></i>
              <i class='fa fa-check m-0 p-0' style='position: relative; left:-9px'></i>
            </button>
          </th>
          </tr>
        </thead>
        <tbody #tableBody>
          <tr *ngFor='let activity of activitiesFormArray.value; let last = last; index as i;' [formGroupName]='i' [appActivityRow]='activity' [ngClass]='{"bg-light shadow sticky-bottom":false}'
          [disabled]='activity.closed'>
            <td>
              {{ i }}
            </td>
            <td>
              {{ utils.getActivity(activity.activity).label }}
            </td>
            <td [appActivityRow]='activity'>
              {{ npi.activities[i].dept }}
              <select class='custom-select'>
                <option *ngFor='let user of users[npi.activities[i].dept]' value='{{ user._id }}'>{{ user.firstName }} {{ user.lastName }}</option>
              </select>
            </td>
            <td [ngClass]='{"text-danger": activity.term < 0 }'>
              <input type='number' class='form-control' formControlName='term' style='width: 60px' min=0>
            </td>
            <td>
              <input type='text' #startDate [appBlink]='sdp.value' class='form-control form-control-plaintext' formControlName='startDate' aria-describedby="Data de início para atividade {{ npi.activities[i].activity }}"
                #sdp="bsDatepicker" bsDatepicker [bsConfig]='datePickerConfig[i>0?i-1:i]' [ngClass]='{"is-invalid": fieldHasErrors(i+".term")}' readonly>
            </td>
            <td id='endDateCell'>
              <input type='text' class='form-control' #endDate appBlink [activity]='activity' [npi]=npi class='form-control' formControlName='endDate' aria-describedby="Data final para atividade {{ npi.activities[i].activity }}"
                #edp="bsDatepicker" bsDatepicker [bsConfig]='datePickerConfig[i]' [ngClass]='{"is-invalid text-danger": fieldHasErrors(i+".term") || activity.endDate < activity.startDate || (last && activity.endDate > npi.inStockDate) }'
                placement='right' id='{{activity.activity}}_END_DATE'>
            </td>
            <td>
              <button appFileButton type='button' class="btn btn-block btn-light shadow-none m-0" (click)='openFileAction(npi.activities[i].dept)'
                [disabled]='!npiComponent.editFlag'>
                <i class='fa fa-folder fa-fw' [ngClass]='activity.annex?.length? "append-icon":"upload-icon"'></i>
              </button>
            </td>
            <td class=signature>
              <button type=button class='btn btn-block btn-light text-secondary shadow-none m-0' (click)='closeActivity(activity)' *ngIf='!activity.closed && false'
              [disabled]='!npiComponent.editFlag'>
                <i class='fa fa-fw fa-check'></i>
              </button>
              <span *ngIf='!activity.closed && true'>
                  <i class='fa fa-clock-o fa-lg text-warning'></i>
                </span>
              <span *ngIf='activity.closed'>
                <i class='fa fa-check fa-sm text-success'></i>
                {{ signatures[i] }}
              </span>
            </td>
            <td>
              <div class='custom-control custom-checkbox' *ngIf='!utils.getActivity(activity.activity).required' >
                <input type='checkbox' class='custom-control-input' formControlName='apply' id='apply-{{i}}' style='font-size:30pt'>
                <label for='apply-{{i}}' class='custom-control-label pointer' style='position: relative; top: -16px; left:4px'></label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class='release-date text-primary' style='text-shadow: 1px 2px 10px #ccc; height: 0'>
      <div><b>Data de Lançamento</b></div>
      <hr size='6px' width='{{release.offsetLeft + release.offsetWidth - 4}}px' class='m-0 shadow' style='background-color: blue; color: blue; box-shadow: 0 2px 4px #ccc'>
      <br>
      <input type=text class='form-control shadow m-0' #release id='releaseDate' readonly [appInStockDate]='tableBody.lastElementChild.children[5].offsetLeft' style='position:absolute; width: 110px; border-color: blue; top: 24px'
        value='{{ this.npi.inStockDate.toLocaleDateString("pt-br") }}'>
    </div>
    <div style='height: 70px'></div>
  </div>
</div>
<hr>
