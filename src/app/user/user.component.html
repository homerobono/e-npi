<div class=row>
<div class="body-frame col-xs-11 col-sm-10 col-md-9 col-lg-8">
  <app-nav-buttons></app-nav-buttons>
  <div class='float-left nopadding nomargin'>
    <span><h3>Detalhes do Usuário</h3></span>
  </div>
  <span class='ml-auto nopadding'>
    <div class='float-right user user-delete' (click)='deleteUser()'
      data-toggle="tooltip" data-placement="top" title='Excluir usuário'
      *ngIf='userLevel>1'>
      <span class='fa fa-trash'></span>
    </div>
    <div class='float-right user user-edit nomargin' (click)='editUser()'
      data-toggle="tooltip" data-placement="top" title='Editar detalhes'
      *ngIf='userLevel>1'>
      <span class='fa fa-edit'></span>
    </div>
    <div class='float-right user user-edit nomargin' (click)='editUser()'
      data-toggle="tooltip" data-placement="top" title='Editar detalhes'
      *ngIf='userLevel>1 && user.status=="pending"'>
      <button type='button' class='btn btn-light' (click)='reSendRegisterToken()'>
        Reenviar e-mail de cadastro
      </button>
    </div>
  </span>
  <div class='float-left col-12 nomargin nopadding' *ngIf='userResponse'>
    <div class='alert' 
    [ngClass]="{'alert-success' : userSent,
              'alert-danger' : !userSent }">
              {{ userResponse }}
    </div>
  </div>
  <hr class='float-left col-12 nopadding'>
  <div *ngIf='!edit' class='form-row' float-left style='width: 100%'>
    <div class='form-row float-left' style='width: 100%; margin:0'>
      <div class='col-10 float-left'>
        <h4>
          {{ user.firstName }} {{ user.lastName }}</h4>
      </div>
    </div>
    <div class='form-row float-left' style='width: 100%; margin:0'>
      <div class='col-xs-6 col-sm-4'>
        <b>E-mail: </b>
      </div>
      <div class='col-xs-5 col-sm-6 float-left' style='margin: 0'>
        {{ user.email }}
      </div>
    </div>
    <div class='form-row' style='width: 100%; margin:0'>
        <div class='col-xs-6 col-sm-4'>
          <b>Departamento: </b>
        </div>
        <div class='col-xs-5 col-sm-6 float-left' style='margin: 0'>
          {{ user.department }}
        </div>
      </div>
      <div class='form-row' style='width: 100%; margin:0'>
        <div class='col-xs-6 col-sm-4'>
          <b>Telefone: </b>
        </div>
        <div class='col-xs-5 col-sm-6 float-left' style='margin: 0'>
          {{ user.phone }}
        </div>
      </div>
      <div class='form-row' style='width: 100%; margin:0'>
          <div class='col-xs-6 col-sm-4'>
            <b>Nível de Permissão: </b>
          </div>
          <div class='col-xs-5 col-sm-6 float-left' style='margin: 0'>
              {{ user.level == 0 ? 'Normal': 
                 user.level == 1 ? 'Master':
                 user.level == 2 ? 'Administrador':''
              }}
          </div>
        </div>
        <div class='form-row' style='width: 100%; margin:0'>
            <div class='col-xs-6 col-sm-4'>
              <b>Criado em: </b>
            </div>
            <div class='col-xs-5 col-sm-6 float-left' style='margin: 0'>
              {{ user.createdString }}
            </div>
          </div>
  </div>
  <div *ngIf='edit' style='width:100%' class='form-row'>
    <form [formGroup]='userForm' (ngSubmit)="updateUser(userForm.value)">
      <div class="form-row">
        <div class="col-md-6 mb-3">
          <label for="validationCustom01">Nome</label>
          <div class="input-group">
              <div class="input-group-prepend">
                  <span class="input-group-text" id="inputGroupPrependFirstName">
                      <i class="fa fa-user"></i>
                    </span>
              </div>
            <input type="text" class="form-control has-error" id="validationCustom01" placeholder="Nome" aria-describedby="inputGroupPrependFirstName" [formControl]="userForm.controls['firstName']" >
          </div>
          <div [ngClass]="{
              'valid-feedback':userForm.controls['firstName'].valid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['firstName'].touched &&
              userForm.controls['firstName'].valid) ? 'block' : 'none' )
            }"><i class="fa fa-check"></i>
          </div>
          <div [ngClass]="{
            'invalid-feedback':userForm.controls['firstName'].invalid
          }" [ngStyle]="{
            'display' : ( (userForm.controls['firstName'].touched &&
            !userForm.controls['firstName'].pristine &&
            userForm.controls['firstName'].invalid) ? 'block' : 'none' )
          }"> Digite um nome
          </div>
        </div>  
        <div class="col-md-6 mb-3">
          <label for="validationCustom02">Sobrenome</label>
          <input type="text" class="form-control" id="validationCustom02" placeholder="Sobrenome" [formControl]="userForm.controls['lastName']">
          <div [ngClass]="{
              'valid-feedback':userForm.controls['lastName'].valid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['lastName'].touched &&
              userForm.controls['lastName'].valid) ? 'block' : 'none' )
            }"><i class="fa fa-check"></i>
          </div>
          <div [ngClass]="{
            'invalid-feedback':userForm.controls['lastName'].invalid
          }" [ngStyle]="{
            'display' : ( (userForm.controls['lastName'].touched &&
            !userForm.controls['lastName'].pristine &&
            userForm.controls['lastName'].invalid) ? 'block' : 'none' )
          }"> Digite um sobrenome
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-md-12 mb-3">
          <label for="validationCustomEmail">E-Mail</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text" id="inputGroupPrepend">@</span>
            </div>
            <input type="text" class="form-control" id="validationCustomEmail" placeholder="E-mail" aria-describedby="inputGroupPrepend" [formControl]="userForm.controls['email']" > 
            <div [ngClass]="{
              'valid-feedback':userForm.controls['email'].valid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['email'].touched &&
              userForm.controls['email'].valid) ? 'block' : 'none' )
            }"><i class="fa fa-check"></i>
          </div>
          <div [ngClass]="{
            'invalid-feedback':userForm.controls['email'].invalid
          }" [ngStyle]="{
            'display' : ( (userForm.controls['email'].touched &&
            !userForm.controls['email'].pristine &&
            userForm.controls['email'].invalid) ? 'block' : 'none' )
          }"> Digite um e-mail válido
          </div>
          </div>
        </div>
      </div>
      <hr>
      <div class="form-row">
        <div class="col-md-6 mb-3">
          <label for="validationCustom03">Telefone</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text" id="inputGroupPrependPhone">
                  <i class="fa fa-phone"></i>
                </span>
            </div>
          <input type="text" class="form-control" id="validationCustom03" placeholder="Telefone"  aria-describedby="inputGroupPrepend" [formControl]="userForm.controls['phone']" >
            <div [ngClass]="{
              'valid-feedback':userForm.controls['phone'].valid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['phone'].touched &&
              userForm.controls['phone'].valid) ? 'block' : 'none' )
            }"><i class="fa fa-check"></i>
            </div>
            <div [ngClass]="{
              'invalid-feedback':userForm.controls['phone'].invalid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['phone'].touched &&
              !userForm.controls['phone'].pristine &&
              userForm.controls['phone'].invalid) ? 'block' : 'none' )
            }"> Digite um telefone válido
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <label for="validationCustom04">Departamento</label>
          <select class="form-control" id="validationCustom04" [formControl]="userForm.controls['department']">
            <option *ngFor="let dept of departments" [selected]='dept==user.department'>{{ dept }}</option>
          </select>  
          <div [ngClass]="{
              'valid-feedback':userForm.controls['department'].valid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['department'].touched &&
              userForm.controls['department'].valid) ? 'block' : 'none' )
          }"><i class="fa fa-check"></i>
          </div>
          <div [ngClass]="{
              'invalid-feedback':userForm.controls['department'].invalid
            }" [ngStyle]="{
              'display' : ( (userForm.controls['department'].touched &&
              !userForm.controls['department'].pristine &&
              userForm.controls['department'].invalid) ? 'block' : 'none' )
            }"> Escolha um departamento
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-md-12 mb-3">
          <label for="validationCustom05">Nível de Permissão</label>

          <div class="form-group">
            <div class='row'>

              <!-- Normal -->
              <div class='col-4'>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input" id="defaultInline1" 
                  [formControl]="userForm.controls['level']" name="level" value=0>
                  <label class="custom-control-label" for="defaultInline1">
                      Normal<br>
                      <div class='col-xs-11 radio-level-legend'>
                          Usuário normal, com restrições padrão, 
                          pode visualizar, criar NPI's e O&M's e editá-las, 
                          restrito ao seu departamento.                  
                        </div>
                  </label>
                </div>
              </div>
              
              <!-- Master -->
              <div class='col-4'>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input" id="defaultInline2" 
                  name="level" value=1 [formControl]="userForm.controls['level']">
                  <label class="custom-control-label" for="defaultInline2">
                    Master<br>
                    <div class='col-xs-11 radio-level-legend'>
                        Usuário privilegiado, pode sobrescrever decisões da análise crítica, 
                        independente do departamento. 
                        Pode visualizar usuários.
                    </div>
                  </label>
                </div>
              </div>
              
              <!-- Administrador-->
              <div class='col-4'>
                <div class="custom-control custom-radio custom-control-inline">
                  <input type="radio" class="custom-control-input" id="defaultInline3"
                  name="level" value=2 [formControl]="userForm.controls['level']">
                  <label class="custom-control-label" for="defaultInline3">
                    Administrador<br>
                    <div class='col-xs-11 radio-level-legend'>
                      Usuário com nível de permissão máximo, pode editar qualquer campo. 
                      Deve ser usado somente para propósito de manutenção do sistema.
                      Pode gerenciar usuários (cadastrar, editar, excluir).
                    </div>
                  </label>
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>
      <div class="row align-items-center justify-content-center">
        <button type="submit" class="btn btn-success" 
        [disabled]="!userForm.valid || sendingUser">
          Salvar Alterações</button>
      </div>
    </form>
  </div>
</div>
</div>

